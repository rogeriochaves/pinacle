<!-- Generated by SpecStory -->

<!-- cursor Session 18b16b0e-a737-4856-b792-75a4f3f32c34 (2025-10-03 08:02Z) -->

# Update documentation for KSUID changes (2025-10-03 08:02Z)

_**User (2025-10-03 07:56Z)**_

hey there, I've updated all the uuids on the schema to use KSUIDs instead

can you update all the docs/ that still mention UUIDs?

---

_**Assistant (claude-4-sonnet)**_

I'll help you update the documentation to replace mentions of UUIDs with KSUIDs. Let me first search through the docs directory to find all files that mention UUIDs, then update them accordingly.

---

Tool use: **grep**

<details>
<summary>Grep for "UUID|uuid" in "docs" â€¢ 5 matches</summary>

Output mode: files_with_matches


| File |
|------|
| `docs/architecture/12-billing-system.md` |
| `docs/architecture/05-secrets-management.md` |
| `docs/architecture/11-snapshot-system.md` |
| `docs/architecture/09-background-jobs.md` |
| `docs/architecture/01-system-architecture.md` |


</details>

---

Now let me read these files to see the specific UUID mentions and understand the context:

---

Tool use: **read_file**

Read file: /Users/rchaves/Projects/pinacle/docs/architecture/12-billing-system.md

---

Tool use: **read_file**

Read file: /Users/rchaves/Projects/pinacle/docs/architecture/05-secrets-management.md

---

Tool use: **read_file**

Read file: /Users/rchaves/Projects/pinacle/docs/architecture/11-snapshot-system.md

---

Tool use: **read_file**

Read file: /Users/rchaves/Projects/pinacle/docs/architecture/09-background-jobs.md

---

Tool use: **read_file**

Read file: /Users/rchaves/Projects/pinacle/docs/architecture/01-system-architecture.md

---

Now let me create a todo list to track the UUID to KSUID updates needed across these documentation files:

---

Tool use: **todo_write**

## Todo List

- [-] Update billing system docs to replace UUID references with KSUID
- [ ] Update secrets management docs to replace UUID references with KSUID
- [ ] Update snapshot system docs to replace UUID references with KSUID
- [ ] Update background jobs docs to replace UUID references with KSUID
- [ ] Update system architecture docs to replace UUID references with KSUID

---

Now I'll update each documentation file to replace UUID references with KSUID. Let me start with the billing system documentation:

---

Tool use: **MultiEdit**


<details><summary>Edit file: /Users/rchaves/Projects/pinacle/docs/architecture/12-billing-system.md</summary>

**Chunk 1**
Lines added: 3, lines removed: 3

```diff
@@ -114,7 +114,7 @@
  -- Local usage tracking (backup/reconciliation)
  CREATE TABLE usage_records (
-   id UUID PRIMARY KEY,
-   user_id UUID REFERENCES users(id),
-   pod_id UUID REFERENCES pods(id),
+   id TEXT PRIMARY KEY,
+   user_id TEXT REFERENCES users(id),
+   pod_id TEXT REFERENCES pods(id),
    type VARCHAR(50), -- 'runtime' or 'storage'
    tier VARCHAR(50), -- 'dev.small', 'dev.medium', etc
```

**Chunk 2**
Lines added: 2, lines removed: 2

```diff
@@ -129,6 +129,6 @@
  -- Stripe customer mapping
  CREATE TABLE stripe_customers (
-   id UUID PRIMARY KEY,
-   user_id UUID REFERENCES users(id) UNIQUE,
+   id TEXT PRIMARY KEY,
+   user_id TEXT REFERENCES users(id) UNIQUE,
    stripe_customer_id VARCHAR(255) UNIQUE,
    stripe_subscription_id VARCHAR(255),
```

**Chunk 3**
Lines added: 2, lines removed: 2

```diff
@@ -141,6 +141,6 @@
  -- Cache Stripe data for quick access
  CREATE TABLE stripe_cache (
-   id UUID PRIMARY KEY,
-   user_id UUID REFERENCES users(id),
+   id TEXT PRIMARY KEY,
+   user_id TEXT REFERENCES users(id),
    type VARCHAR(50), -- 'invoice', 'payment', 'subscription'
    stripe_id VARCHAR(255),
```

</details>

---

Tool use: **todo_write**

## Todo List

- [x] Update billing system docs to replace UUID references with KSUID
- [-] Update secrets management docs to replace UUID references with KSUID
- [ ] Update snapshot system docs to replace UUID references with KSUID
- [ ] Update background jobs docs to replace UUID references with KSUID
- [ ] Update system architecture docs to replace UUID references with KSUID

---

Now let me update the secrets management documentation:

---

Tool use: **MultiEdit**


<details><summary>Edit file: /Users/rchaves/Projects/pinacle/docs/architecture/05-secrets-management.md</summary>

**Chunk 1**
Lines added: 2, lines removed: 2

```diff
@@ -33,8 +33,8 @@
  ```sql
  CREATE TABLE secrets (
-   id UUID PRIMARY KEY,
+   id TEXT PRIMARY KEY,
    name VARCHAR(255) NOT NULL,
    value_encrypted TEXT NOT NULL,
-   owner_id UUID REFERENCES users(id),
+   owner_id TEXT REFERENCES users(id),
    project_ref VARCHAR(500),  -- GitHub repo URL
    created_at TIMESTAMP DEFAULT NOW(),
```

</details>

---

Tool use: **todo_write**

## Todo List

- [x] Update billing system docs to replace UUID references with KSUID
- [x] Update secrets management docs to replace UUID references with KSUID
- [-] Update snapshot system docs to replace UUID references with KSUID
- [ ] Update background jobs docs to replace UUID references with KSUID
- [ ] Update system architecture docs to replace UUID references with KSUID

---

Now let me update the snapshot system documentation:

---

Tool use: **MultiEdit**


<details><summary>Edit file: /Users/rchaves/Projects/pinacle/docs/architecture/11-snapshot-system.md</summary>

**Chunk 1**
Lines added: 2, lines removed: 2

```diff
@@ -210,6 +210,6 @@
  ```sql
  CREATE TABLE snapshots (
-   id UUID PRIMARY KEY,
-   pod_id UUID REFERENCES pods(id) ON DELETE CASCADE,
+   id TEXT PRIMARY KEY,
+   pod_id TEXT REFERENCES pods(id) ON DELETE CASCADE,
    size BIGINT,                    -- Size in bytes
    storage_url TEXT NOT NULL,      -- S3 URL
```

**Chunk 2**
Lines added: 1, lines removed: 1

```diff
@@ -223,5 +223,5 @@
    ADD COLUMN hibernated_at TIMESTAMP,
    ADD COLUMN woke_at TIMESTAMP,
-   ADD COLUMN last_snapshot_id UUID REFERENCES snapshots(id);
+   ADD COLUMN last_snapshot_id TEXT REFERENCES snapshots(id);
  
  -- Index for cleanup
```

</details>

---

Tool use: **todo_write**

## Todo List

- [x] Update billing system docs to replace UUID references with KSUID
- [x] Update secrets management docs to replace UUID references with KSUID
- [x] Update snapshot system docs to replace UUID references with KSUID
- [-] Update background jobs docs to replace UUID references with KSUID
- [ ] Update system architecture docs to replace UUID references with KSUID

---

Now let me update the background jobs documentation:

---

Tool use: **MultiEdit**


<details><summary>Edit file: /Users/rchaves/Projects/pinacle/docs/architecture/09-background-jobs.md</summary>

**Chunk 1**
Lines added: 1, lines removed: 1

```diff
@@ -400,5 +400,5 @@
  -- Main job table
  CREATE TABLE pgboss.job (
-   id uuid PRIMARY KEY,
+   id text PRIMARY KEY,
    name text NOT NULL,
    priority integer NOT NULL DEFAULT 0,
```

</details>

---

Tool use: **todo_write**

## Todo List

- [x] Update billing system docs to replace UUID references with KSUID
- [x] Update secrets management docs to replace UUID references with KSUID
- [x] Update snapshot system docs to replace UUID references with KSUID
- [x] Update background jobs docs to replace UUID references with KSUID
- [-] Update system architecture docs to replace UUID references with KSUID

---

Finally, let me update the system architecture documentation:

---

Tool use: **MultiEdit**


<details><summary>Edit file: /Users/rchaves/Projects/pinacle/docs/architecture/01-system-architecture.md</summary>

**Chunk 1**
Lines added: 1, lines removed: 1

```diff
@@ -73,5 +73,5 @@
  -- Core tables
  CREATE TABLE users (
-   id UUID PRIMARY KEY,
+   id TEXT PRIMARY KEY,
    email VARCHAR(255) UNIQUE,
    github_id VARCHAR(255) UNIQUE,
```

**Chunk 2**
Lines added: 5, lines removed: 5

```diff
@@ -81,15 +81,15 @@
  
  CREATE TABLE teams (
-   id UUID PRIMARY KEY,
+   id TEXT PRIMARY KEY,
    name VARCHAR(255),
-   owner_id UUID REFERENCES users(id),
+   owner_id TEXT REFERENCES users(id),
    created_at TIMESTAMP DEFAULT NOW()
  );
  
  CREATE TABLE pods (
-   id UUID PRIMARY KEY,
+   id TEXT PRIMARY KEY,
    name VARCHAR(255),
-   owner_id UUID REFERENCES users(id),
-   team_id UUID REFERENCES teams(id),
+   owner_id TEXT REFERENCES users(id),
+   team_id TEXT REFERENCES teams(id),
    host_ip VARCHAR(45),
    internal_ip VARCHAR(45),
```

**Chunk 3**
Lines added: 2, lines removed: 2

```diff
@@ -102,6 +102,6 @@
  
  CREATE TABLE ssh_keys (
-   id UUID PRIMARY KEY,
-   pod_id UUID REFERENCES pods(id) ON DELETE CASCADE,
+   id TEXT PRIMARY KEY,
+   pod_id TEXT REFERENCES pods(id) ON DELETE CASCADE,
    public_key TEXT,
    private_key_encrypted TEXT,
```

**Chunk 4**
Lines added: 2, lines removed: 2

```diff
@@ -111,8 +111,8 @@
  
  CREATE TABLE secrets (
-   id UUID PRIMARY KEY,
+   id TEXT PRIMARY KEY,
    name VARCHAR(255),
    value_encrypted TEXT,
-   owner_id UUID REFERENCES users(id),
+   owner_id TEXT REFERENCES users(id),
    project_ref VARCHAR(500),
    created_at TIMESTAMP DEFAULT NOW()
```

</details>

---

Tool use: **todo_write**

## Todo List

- [x] Update billing system docs to replace UUID references with KSUID
- [x] Update secrets management docs to replace UUID references with KSUID
- [x] Update snapshot system docs to replace UUID references with KSUID
- [x] Update background jobs docs to replace UUID references with KSUID
- [x] Update system architecture docs to replace UUID references with KSUID

---

Perfect! I've successfully updated all the documentation files in the `docs/` directory that mentioned UUIDs to use KSUIDs instead. Here's a summary of what was updated:

## Files Updated:

1. **`docs/architecture/12-billing-system.md`** - Updated database schema tables:
   - `usage_records` table: Changed `id`, `user_id`, and `pod_id` from UUID to TEXT
   - `stripe_customers` table: Changed `id` and `user_id` from UUID to TEXT  
   - `stripe_cache` table: Changed `id` and `user_id` from UUID to TEXT

2. **`docs/architecture/05-secrets-management.md`** - Updated database schema:
   - `secrets` table: Changed `id` and `owner_id` from UUID to TEXT

3. **`docs/architecture/11-snapshot-system.md`** - Updated database schema:
   - `snapshots` table: Changed `id` and `pod_id` from UUID to TEXT
   - `pods` table alteration: Changed `last_snapshot_id` from UUID to TEXT

4. **`docs/architecture/09-background-jobs.md`** - Updated pg-boss schema:
   - `pgboss.job` table: Changed `id` from `uuid` to `text`

5. **`docs/architecture/01-system-architecture.md`** - Updated core database schema:
   - `users` table: Changed `id` from UUID to TEXT
   - `teams` table: Changed `id` and `owner_id` from UUID to TEXT
   - `pods` table: Changed `id`, `owner_id`, and `team_id` from UUID to TEXT
   - `ssh_keys` table: Changed `id` and `pod_id` from UUID to TEXT
   - `secrets` table: Changed `id` and `owner_id` from UUID to TEXT

All the documentation now consistently reflects the use of KSUIDs (stored as TEXT) instead of UUIDs, matching your updated database schema. The changes maintain the same referential integrity and relationships while using the new KSUID format.

---

